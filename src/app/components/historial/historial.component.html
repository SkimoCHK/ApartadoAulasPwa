<div class="historial-container">
  <!-- Header -->
  <header class="header">
    <button class="back-button" (click)="onBack()">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
    </button>
    <h1 class="header-title">Historial de Reservas</h1>
  </header>

  <!-- Main Content -->
  <div class="content">
    <!-- Error Message -->
    <div class="error-message" *ngIf="error">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <span>{{ error }}</span>
    </div>

    <!-- Loading -->
    <div class="loading-spinner" *ngIf="loading">
      <div class="spinner"></div>
      <p>Cargando historial...</p>
    </div>

    <!-- Content -->
    <div *ngIf="!loading && !error">
      <!-- Stats Section -->
      <div class="stats-section">
        <div class="stat-card">
          <div class="stat-number">{{ totalReservas }}</div>
          <div class="stat-label">
            {{
              filtroEstado ? "Reservas " + filtroEstado : "Total de reservas"
            }}
          </div>
        </div>
      </div>

      <!-- Filtros -->
      <div class="filters-section">
        <div class="filter-group">
          <label for="filtro">Filtrar por estado:</label>
          <select id="filtro" [(ngModel)]="filtroEstado" class="filter-select">
            <option value="">Todas</option>
            <option *ngFor="let estado of estados" [value]="estado">
              {{ estado }}
            </option>
          </select>
          <button
            *ngIf="filtroEstado"
            (click)="clearFilter()"
            class="btn-clear-filter"
          >
            Limpiar
          </button>
        </div>
      </div>

      <!-- Reservas List -->
      <div class="reservas-section">
        <div *ngIf="reservasFiltradas.length === 0" class="no-reservas">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <p>
            {{
              filtroEstado
                ? "No tienes reservas " + filtroEstado
                : "No tienes reservas en tu historial"
            }}
          </p>
        </div>

        <div
          *ngFor="let reserva of reservasFiltradas"
          class="reserva-card"
          [ngClass]="getStatusClass(reserva.estado)"
        >
          <!-- Status Badge -->
          <div class="reserva-header">
            <div class="reserva-title">
              <h3 class="reserva-aula">{{ reserva.aula.nombre }}</h3>
              <p class="reserva-motivo">{{ reserva.motivo }}</p>
            </div>
            <div
              class="status-badge"
              [ngClass]="getStatusClass(reserva.estado)"
            >
              <span class="status-icon">{{
                getStatusIcon(reserva.estado)
              }}</span>
              <span class="status-text">{{ reserva.estado }}</span>
            </div>
          </div>

          <!-- Reserva Details -->
          <div class="reserva-details">
            <!-- Fecha -->
            <div class="detail-item">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <div class="detail-text">
                <span class="detail-label">Fecha</span>
                <span class="detail-value">
                  {{ getDayName(reserva.fecha) | titlecase }}
                  {{ formatDate(reserva.fecha) }}
                </span>
              </div>
            </div>

            <!-- Horario -->
            <div class="detail-item">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              <div class="detail-text">
                <span class="detail-label">Horario</span>
                <span class="detail-value">
                  {{ formatTime(reserva.horaInicio) }} -
                  {{ formatTime(reserva.horaFin) }}
                </span>
              </div>
            </div>

            <!-- Capacidad -->
            <div class="detail-item">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
              </svg>
              <div class="detail-text">
                <span class="detail-label">Capacidad</span>
                <span class="detail-value">
                  {{ reserva.aula.capacidadEstudiantes }} estudiantes
                </span>
              </div>
            </div>

            <!-- Fecha de Solicitud -->
            <div class="detail-item">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              <div class="detail-text">
                <span class="detail-label">Solicitada el</span>
                <span class="detail-value">
                  {{ formatDate(reserva.fechaSolicitud) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
